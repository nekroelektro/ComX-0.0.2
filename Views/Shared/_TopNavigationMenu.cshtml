@using ComX_0._0._2.Helpers
@{
    ArticleHelper articleHelper = new ArticleHelper();
    GeneralHelper generalHelper = new GeneralHelper();
    var categoryList = articleHelper.GetAllCategories();
    var subCategoryList = articleHelper.GetAllSubCategories();
}
<div class="main" style="width: 100%">
    <div class="absoluteLogo" style="display: none; margin-top: -1.5em; z-index: 5; position: absolute; width: 20%;">
        <a href="@Url.Action("Index", "Articles")">
            <img src='~/Content/images/npLogosBeta.png' style="float: left; width: 100%; height: auto; text-align: center;"/>
        </a>
    </div>
    <nav id="cbp-hrmenu" class="cbp-hrmenu">
        <ul>
            @foreach (var item in categoryList) {
                <li>
                    <a href="#">@item.Name</a>
                    <div class="cbp-hrsub">
                        <div class="cbp-hrsub-inner" style="padding-left: 0; padding-right: 0; width: 80%;">
                            <h5>@item.Description</h5>
                            <div class="subCategoriesNavigation" style="width: 100%; display: inline-flex; padding-bottom: 1em;">
                                @foreach (var subItem in subCategoryList) {
                                    if (!articleHelper.SubCategoryIsEmpty(subItem.Id, item.Id)) {
                                        <div class="subCategoryListNavigation" style="width: 20%;">
                                            <h4 style="padding-top: 5px; font-size: 1.3em;">@subItem.Name:</h4>
                                            <ul>
                                                @foreach (var article in articleHelper.GetArticlesByBothCategories(item.Id, subItem.Id, 3)) {
                                                    <li>
                                                        <a href="@HttpUtility.UrlDecode(Url.Action("Details", "Articles", new {@id = generalHelper.RemoveSpecialCharsFromString(article.Name)}))" style="font-size: 1em;"><span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> @article.Name</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                }
                            </div>
                            <div class="lastArticlesFromCategoryTopNavigation" style="width: 100%">
                                <h4 style="padding-top: 5px; font-size: 1.3em;">Ostatnie posty z kategorii @item.Name:</h4>
                                <hr style="margin-top: 0; margin-bottom: 0;"/>
                                <div class="lastArticlesTop" style="display: inline-flex; margin: 0 auto; text-align: center; width: 100%; padding-top: 1em;">
                                    @foreach (var lastArticle in articleHelper.GetLastArticlesFromCategory(4, item.Id, Guid.Empty)) {
                                        <a class="topNavigationLastAnchor" href="@HttpUtility.UrlDecode(Url.Action("Details", "Articles", new {@id = generalHelper.RemoveSpecialCharsFromString(lastArticle.Name)}))" style="width: 22%;margin: 0 auto; text-align: center;">
                                            <div class="singleLastArticleTopNavigation" style="width: 100%; height: 15em; overflow: hidden; position: relative; border: 1px solid white;">
                                                <div class="imageOverlayColor" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: rgba(0, 0, 0, 0.7); z-index: 2;"></div>
                                                <div class="bannerPanelImageContainer" style="width: 100%; height: 100%; text-align: center; margin: 0 auto; background-color: black; z-index: 1; overflow: hidden;">
                                                    <img src='@Url.Content(articleHelper.GetImageRelativePathByArticleId(lastArticle.Id))' style="min-width: 100%; min-height: 100%; text-align: center; margin: 0 auto; z-index: 0; vertical-align: middle;" />
                                                </div>
                                                <div class="bannerPanelImageMain" style="width: 100%; height: 100%; text-align: center; margin: 0 auto; z-index: 3; overflow: hidden; position: absolute; top: 0;">
                                                    <img src='@Url.Content(articleHelper.GetImageRelativePathByArticleId(lastArticle.Id))' style="max-height:100%; max-width: 100%; text-align: center; margin: 0 auto; z-index: 0; vertical-align: middle;" />
                                                </div>
                                                <div class="titleTopNavigation" style="display: none; width: 100%; height: 45%; font-size: 0.9em; color: black; text-align: center; position: absolute; bottom: 0; z-index: 7; background: rgba(255, 255, 255, 0.6);">
                                                    <p style="padding: 0.5em;">@lastArticle.Name</p>
                                                    @*<div class="moreTopNavigationSingle" style="position: absolute; bottom: 0; right: 0.5em;z-index: 7">
                                                        <p>...more <span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span></p>
                                                    </div>*@
                                                </div>
                                            </div>
                                        </a>
                                    }
                                </div>
                            </div>
                            <div class="moreFromCategoryTopNavigation" style="float: right; clear: both; font-size: 1.1em;">
                                <a class="seeMoreFromCategoryTopNavigation" href="@Url.Action("Categories", "Articles", new {@id = item.Name})">
                                    <p>Zobacz wszystkie z kategorii @item.Name <span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span></p>
                                </a>
                            </div>
                        </div>
                    </div>
                </li>
            }
        </ul>
    </nav>
</div>

<script>
    $(document).ready(function() {

        var cbpHorizontalMenu = (function() {

            var $listItems = $('#cbp-hrmenu > ul > li'),
                $menuItems = $listItems.children('a'),
                $body = $('body'),
                current = -1;

            function init() {
                $menuItems.on('click', open);
                $listItems.on('click', function(event) {
                    event.stopPropagation();
                });
            }

            function open(event) {
                if (current !== -1) {
                    $listItems.eq(current).removeClass('cbp-hropen');
                    $(".elementsToPush").css("margin-top", 0);
                }

                var $item = $(event.currentTarget).parent('li'),
                    idx = $item.index();

                if (current === idx) {
                    $item.removeClass('cbp-hropen');
                    $(".elementsToPush").css("margin-top", 0);
                    current = -1;
                } else {
                    $item.addClass('cbp-hropen');
                    var subList = document.getElementsByClassName("cbp-hrsub");
                    $(".elementsToPush").css("margin-top", $(subList[idx]).height() + 20);
                    current = idx;
                    $body.off('click').on('click', close);
                }

                return false;

            }

            function close(event) {
                $(".main").classList.remove("topMenuSingleActive");
                $(".main").toggleClass("topMenuSingleInActive");
                $listItems.eq(current).removeClass('cbp-hropen');
                current = -1;
            }

            return { init: init };

        })();

        $(function() {
            cbpHorizontalMenu.init();
        });

        //Sticky top menu:
        $(".main").sticky({ topSpacing: 0, zIndex: 6 });
        $('.main').on('sticky-start', function(e) {
            $('.absoluteLogo').show();
            $(".cbp-hrsub-inner").css("width", "100%");
            $(".main").css("box-shadow", "0 0 10px 10px #222222");
        });
        $('.main').on('sticky-end', function() {
            $('.absoluteLogo').hide();
            $(".cbp-hrsub-inner").css("width", "80%");
        });

        $('.singleLastArticleTopNavigation')
            .mouseover(function () {
            $(this).find('.titleTopNavigation').show();
            })
            .mouseout(function () {
                $(this).find('.titleTopNavigation').hide();
            })
    });
</script>
